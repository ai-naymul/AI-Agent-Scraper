<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI-Agent-Scraper</title>
<style>
 body{font-family:Arial;margin:0;padding:0;display:flex;height:100vh}
 #left{flex:0 0 300px;padding:20px;border-right:1px solid #ddd}
 #right{flex:1;display:flex;flex-direction:column}
 #screens{flex:1;overflow:auto;background:#000}
 img{width:100%;height:auto}
</style>
</head>
<body>
<div id="left">
  <h3>Prompt</h3>
  <textarea id="prompt" rows="8" style="width:100%;">go to https://www.ycombinator.com/jobs and save open roles as txt</textarea>
  <label>Format:
    <select id="fmt">
      <option>txt</option><option>md</option><option>json</option><option>html</option>
    </select>
  </label><br/>
  <label><input type="checkbox" id="headless" checked/> Headless</label><br/><br/>
  <button onclick="run()">Run</button>
  <div id="status"></div>
  <a id="download" style="display:none;">Download result</a>
</div>
<div id="right">
  <div id="screens"></div>
</div>

<script>
async function run() {
  document.getElementById("screens").innerHTML="";
  const body = {
    prompt: document.getElementById("prompt").value,
    format: document.getElementById("fmt").value,
    headless: document.getElementById("headless").checked
  };
  const res = await fetch("/job", {method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
  const {job_id} = await res.json();
  document.getElementById("status").textContent="Job "+job_id;
  const sock = new WebSocket(`ws://${location.host}/ws/${job_id}`);
  sock.onmessage = ev => {
    const msg = JSON.parse(ev.data);
    if (msg.screenshot){
      const img = new Image();
      img.src="data:image/png;base64,"+msg.screenshot;
      document.getElementById("screens").prepend(img);
    }
    if (msg.status==="saved"){
      const link = document.getElementById("download");
      link.href=`/download/${job_id}`;
      link.textContent="Download";
      link.style.display="block";
    }
  }
}
</script>
</body>
</html>